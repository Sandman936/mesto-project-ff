(()=>{"use strict";var e=function(e,t,o,n,r,c,u,a){var i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),s=i.querySelector(".card__image"),l=i.querySelector(".card__title"),p=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),_=i.querySelector(".card__like-counter");return l.textContent=e.name,s.src=e.link,s.alt=e.name,_.textContent=e.likes.length,t?p.addEventListener("click",(function(t){n(t,e)})):p.remove(),o?d.classList.add("card__like-button_is-active"):d.classList.remove("card__like-button_is-active"),d.addEventListener("click",(function(t){r(t,e._id,o,d,_,u,a)})),s.addEventListener("click",(function(){return c(e)})),i};function t(e,t,o,n,r,c,u){e.target.classList.contains("card__like-button_is-active")?u(t).then((function(e){n.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length})).catch((function(e){console.error(e)})):c(t).then((function(e){n.classList.add("card__like-button_is-active"),r.textContent=e.likes.length})).catch((function(e){console.error(e)}))}function o(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",c)}function n(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keydown",c)}function r(e){e.target===e.currentTarget&&n(e.currentTarget)}function c(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function u(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){a(e,o,t)})),i(o,n,t)}function a(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function i(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}var s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-8",headers:{authorization:"16d9fcd2-6486-4fff-bda9-31ea0dd0b509","Content-Type":"application/json"}};function l(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))}function p(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))}var d,_,f,m=document.querySelector(".places__list"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__image"),b=document.querySelectorAll(".popup"),S=document.querySelector(".popup_type_avatar"),C=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),E=q.querySelector(".popup__image"),L=q.querySelector(".popup__caption"),g=document.querySelector(".popup_type_conformation"),x=g.querySelector(".popup_confirm-button"),j=document.forms.editAvatar,P=j.link,B=document.forms.editProfile,A=B.name,w=B.description,U=document.forms.newPlace,T=U.placeName,D=U.link,N=document.querySelector(".profile__image"),O=document.querySelector(".profile__title"),J=document.querySelector(".profile__description");function M(e){L.textContent=e.name,E.src=e.link,E.alt=e.name,o(q)}function H(e,t){d=t,_=e.target.closest(".card"),o(g)}y.addEventListener("click",(function(){o(S),j.reset(),u(j,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),v.addEventListener("click",(function(){o(k),U.reset(),u(U,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),h.addEventListener("click",(function(){o(C),A.value=O.textContent,w.value=J.textContent,u(B,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),x.addEventListener("click",(function(){var e,t;(t=d._id,fetch("".concat(s.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((e=_,void e.remove())).catch((function(e){console.error(e)})),n(g)})),b.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){n(e)})),e.addEventListener("mousedown",r)})),B.addEventListener("submit",(function(e){var t,o,r=C.querySelector(".button");e.preventDefault(),r.textContent="Сохранение...",(t=A.value,o=w.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){O.textContent=e.name,J.textContent=e.about})).catch((function(e){console.error(e)})).finally((function(){r.textContent="Сохранение",n(C)}))})),U.addEventListener("submit",(function(o){var r,c,a=k.querySelector(".button");o.preventDefault(),a.textContent="Сохранение...",(r=T.value,c=D.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(o){var n;n=e(o,!0,!1,H,t,M,l,p),m.prepend(n)})).catch((function(e){console.error(e)})).finally((function(){u(U,{submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"}),a.textContent="Сохранение",n(k)}))})),j.addEventListener("submit",(function(e){var t,o=S.querySelector(".button");e.preventDefault(),o.textContent="Сохранение...",(t=P.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){N.setAttribute("style","background-image: url(".concat(e.avatar,")"))})).catch((function(e){console.error(e)})).finally((function(){o.textContent="Сохранение",n(S)}))})),f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(f.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,o,t.validationMessage)}(e,r,t),i(o,n,t)}))}))}(e,f)})),Promise.all([fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)})),fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Код ошибки: ".concat(e.status))})).catch((function(e){console.error(e)}))]).then((function(o){var n=o[0],r=o[1];N.setAttribute("style","background-image: url(".concat(n.avatar,")")),O.textContent=n.name,J.textContent=n.about,r.forEach((function(o){var r=n._id===o.owner._id,c=o.likes.flat().some((function(e){return e._id===n._id}));!function(o,n,r){var c=e(o,n,r,H,t,M,l,p);m.append(c)}(o,r,c)}))})).catch((function(e){console.error(e)}))})();
//# sourceMappingURL=main.js.map